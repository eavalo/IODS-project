# Logistic regression

## Data
The dataset has been constructed by joining two student alchol comsuption datasets which were downloaded from https://archive.ics.uci.edu/ml/datasets/Student+Performance. The two datasets contain the same variables and the students are partially overlapping. The data was joined by using following columns as surrogate identifiers for students:

* *school, sex, age, address, famsize, Pstatus, Medu, Fedu, Mjob, Fjob, reason, nursery, internet*

The variables not used for joining have been combined by averaging for numeric columns and by taking the first answer for non-numeric columns. Two new variables have been define:

* *alc_use* is the average of *Dalc* and *Walc*
* *high_use* is TRUE if *alc_use* is hihger than 2 and FALSE otherwise

Read in the dataset.

```{r data_reading_e3}
alc <- read.csv("~/git/IODS-project/data/alc.csv")
```

Variables in the data set:
```{r data_check_e3}
str(alc)
```

## Predictors of high alchol consumption

### Hypothesis
I choose the following 4 variables for studying their relationship to high/low alcohol consumption:

* *goout*  - going out with friends (numeric: from 1 - very low to 5 - very high)
* *sex* - student's sex (binary: 'F' - female or 'M' - male)
* *studytime* - weekly study time (numeric: 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours)
* *romantic* - with a romantic relationship (binary: yes or no) 

I hypotize that high amount of "going out with friends" would be associated with a higer alcohol consumption since alcohol is often consumed in social situations. I think male gender could be associated to higher alcohol consumption just because males can tolerate more alcohol. I hypotize that higher "weekly study time" is associated to low alcohol compsuption: students with high study times are focused on school and don't have as much time to drink alcohol. I also hypotize that individuals "with a romatic relationship" will consume less aclhol since they spend more time with their partners than friens and alchol is more often spend with friends.

### Data exploration
Explore the variables of interest in regard to alchohol use

```{r exploratory_plots_3, fig.height=12, fig.width=12, warning=F, message=F}
library(tidyr)
library(dplyr)
library(ggplot2)

# Explore the mean 'goout' and 'studytime' with respect to high/low alcohol use
alc %>% group_by(high_use) %>% summarise(count = n(), mean_goout=mean(goout),
                                         mean_studytime=mean(studytime))

# Explore high/low alcohol use stratified by 'sex'
alc %>% group_by(high_use, sex) %>% summarise(count = n())

# Explore high/low alcohol use stratified by 'romantic'
alc %>% group_by(high_use, romantic) %>% summarise(count = n())

# Draw barplots of variables of interest
###########################################

g_goout <- ggplot(alc, aes(x = goout, fill=high_use)) +
  geom_bar() + xlab("Going out with friends") +
  ggtitle("Going out with friends from 1 (very low) to 5 (very high) by alcohol use")

g_studytime <- ggplot(alc, aes(x = studytime, fill=high_use)) +
  geom_bar() + xlab("Weekly study time") +
  ggtitle("Weekly study time [1 (<2 hours), 2 (2 to 5 hours), 3 (5 to 10 hours), or 4 (>10 hours)] by alchol use")

g_sex <- ggplot(alc, aes(x = sex, fill=high_use)) +
  geom_bar() + 
  ggtitle("Sex by alcohol use")

g_romantic <- ggplot(alc, aes(x = romantic, fill=high_use)) +
  geom_bar() + 
  ggtitle("With a romantic relationship (yes/no) by alcohol use")

# Arrange the plots into a grid
library("gridExtra")
grid.arrange(g_goout, g_studytime, g_sex, g_romantic, ncol=2, nrow=2)


```

Based on the plots my assumptions seem to be somewhat corret:

* High alchol use is associated with going out with friends
* Low alchol use is asscoated with high weekly study time
* High alchol use is more common in men compared to women
* Low alchol use is more common in individuals in romatic relationships

### Fitting a logistic regression model

Fit a logistic regression model using *high_use* as the targe variable and *goout*, *studytime*, *sex* and *romantic* as the explanatory variables.

```{r logistic_regression_3}
# Fit the logistic regression model
m <- glm(high_use ~ goout + studytime + sex + romantic, data = alc, family = "binomial")
```

Summary of the fitted logistics regression model shows that *goout*, *studytime* and *sex* are statistically significantly associated to alchol comsumption. High alcohol comsumption is associated to high *goout* and male gender and low alcohol comsumption is associated to high *studytime*.

```{r logistic_regression_summary_3}
# Summary of the model
summary(m)
```

Coefficients of the model as odds ratios and their confidence intervals:
```{r logistic_regression_or_3, message=F}
# Calculate the odds ratios and confidence intervals of the coefficients
or <- coef(m) %>% exp
ci <- confint(m) %>% exp
# Print out the odds ratios and confidence intervals
cbind(or, ci)
```
From the odds ratios we can see that one unit increase in *goout* is associated with 2.1 times higher likelihood of high alchohol comsumption and one unit increase in *studytime* is associated with 0.6 times lower likelihood of high alcohol comsumption. Male gender is associated with 1.9 higer likelihood of high alcohol comsumption comapred to female gender. Being in a romatic relationship is not significantly associated to high/low alcohol comsuption in this model since the confidence intervals include 1.

My previously stated hypothesis seem to be verified by this model except that *romantic* is not associated to high or low alcohol comsumption in this model.
